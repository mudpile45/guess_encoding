#!/usr/bin/perl
use strict;
use Encode;
binmode STDOUT, ":utf8";

# use constant FREQDIR => 'freqlists';
my @encodings = qw/utf8 big5 euc-cn utf-16 utf-16le utf-16be/; #encodings to check
my %freqs = get_freq_data();

my $infile = shift(@ARGV);
my $in_data = slurp_file($infile);

my @probs = calculate_probs($in_data);
print $probs[0];

###############################################################################
#################################### Directions ###############################
###############################################################################
######                                                                   ######
######       In order to make the inline frequency list, use             ######
###### get_freq_data_from_file() and the merge_freq_data() functions in  ######
######         conjunction with Data::Dumper to replace the hash that    ######
######                       get_freq_data() returns                     ######
######                                                                   ######
###############################################################################
###############################################################################
###############################################################################


sub calculate_probs {
    my $in_data = shift;
    my %results;
    foreach my $enc (@encodings) {
        my $score;
        eval {
            $score = get_prob_for($enc, $in_data);
            # print "Score for $enc: $score\n";
            $results{$enc} = $score;
        }
    }
    my @probs = sort {$results{$b} <=> $results{$a}} keys %results;
    return @probs;
}

# print "Score for big5: " . get_prob_for("big5", $in_data) . "\n";
# print "Score for gb2312: " . get_prob_for("gb2312", $in_data) . "\n";
# print "Score for utf-16: " . get_prob_for("utf-16", $in_data) . "\n";


sub get_prob_for {
    my ($enc, $in_data) = @_;
    my @in_chars = char_arr_for_str(decode($enc, $in_data));

    my $score = 0;
    for (my $i=0; $i < scalar(@in_chars); $i++) {
        my $cur_char = $in_chars[$i];
        # print "[$cur_char] = +" . $freqs{$cur_char}."\n";
        $score += $freqs{$cur_char};
    }
    return $score;
}

sub slurp_file {
    my $infile = shift;
    open DATA, $infile;
    my $in_data;
    {
        local $/;
        $in_data = <DATA>;
    }
    close DATA;
    return $in_data;
}

sub get_freq_data_from_file {
    # returns a hash of all the characters and their rank (based on position in
    # freq file)
    my $freq_file = shift;
    my @orig_chars = split("\n", decode("utf8", slurp_file($freq_file)));

    # Reverse the order of the array so that most frequent chars get highest
    # rank
    my @chars;
    for (my $i = scalar(@orig_chars); $i >= 0; $i--) {
        push(@chars, $orig_chars[$i]);
    }
    my %result;
    for (my $i=0; $i < scalar(@chars); $i++) {
        $result{$chars[$i]} = ($i + 1);
    }
    return %result;
}

sub char_arr_for_str {
    # returns an array of characters for a string
    my $in_str = shift;
    my @res;
    for (my $i=0; $i < length($in_str); $i++) {
        push(@res, substr($in_str, $i, 1));
    }
    return @res;
}

sub print_hash {
    my %freqs = @_;
    foreach my $key (keys(%freqs)) {
        print "$key: " . $freqs{$key} . "\n";
    }
}

sub print_arr {
    my @in_chars = @_;
    foreach (@in_chars) {
        print "$_\n"
    }
}
 
sub merge_freq_data {
    # merge trad and simp freq lists together
    my %freqs_simp = get_freq_data_from_file("freqlist-simp.txt");
    my %freqs_trad = get_freq_data_from_file("freqlist-trad.txt");
    my %freqs = %freqs_simp;

    foreach my $key (keys(%freqs_trad)) {
        if (! $freqs_simp{$key}) {
            $freqs{$key} = $freqs_trad{$key};
        }
    }
}

sub get_freq_data { 
    return
          "\x{5173}" => 340, "\x{4fee}" => 84, "\x{6230}" => 173, "\x{8ba8}" => 157, "\x{53bb}" => 432, "\x{5fc3}" => 434, "\x{5b78}" => 477, "\x{5230}" => 490, "\x{4e9b}" => 393, "\x{5229}" => 148, "\x{7f8e}" => 285, "\x{8c22}" => 379, "\x{82b1}" => 135, "\x{89e3}" => 292, "\x{5458}" => 159, "\x{5b89}" => 144, "\x{4fbf}" => 176, "\x{7d66}" => 302, "\x{677f}" => 71, "\x{8bb2}" => 56, "\x{901f}" => 68, "\x{5f71}" => 163, "\x{7121}" => 418, "\x{842c}" => 123, "\x{5730}" => 420, "\x{6837}" => 390, "\x{597d}" => 481, "\x{592e}" => 143, "\x{6a02}" => 275, "\x{97f3}" => 283, "\x{6e7e}" => 291, "\x{767d}" => 146, "\x{5ba4}" => 116, "\x{5f35}" => 218, "\x{9322}" => 82, "\x{98a8}" => 293, "\x{51fa}" => 447, "\x{7ba1}" => 281, "\x{867d}" => 26, "\x{6c23}" => 193, "\x{6240}" => 455, "\x{68a6}" => 12, "\x{5404}" => 326, "\x{767c}" => 421, "\x{8072}" => 162, "\x{52a8}" => 367, "\x{6cd5}" => 419, "\x{6d3b}" => 204, "\x{91cd}" => 303, "\x{4e4e}" => 47, "\x{5206}" => 355, "\x{6797}" => 183, "\x{5df2}" => 349, "\x{4e48}" => 453, "\x{8fc7}" => 459, "\x{904e}" => 459, "\x{5947}" => 34, "\x{4e0e}" => 374, "\x{56e0}" => 404, "\x{4e8e}" => 414, "\x{5f00}" => 376, "\x{53ef}" => 486, "\x{5e26}" => 49, "\x{6d41}" => 111, "\x{7cfb}" => 353, "\x{8fb9}" => 30, "\x{6765}" => 478, "\x{7247}" => 152, "\x{51b3}" => 125, "\x{5728}" => 494, "\x{6ca1}" => 467, "\x{8b8a}" => 194, "\x{5feb}" => 259, "\x{6539}" => 208, "\x{7ec4}" => 124, "\x{518d}" => 371, "\x{600e}" => 251, "\x{5b9a}" => 401, "\x{5f15}" => 41, "\x{628a}" => 312, "\x{529f}\\" => 165, "\x{7ecf}" => 382, "\x{7d71}" => 233, "\x{8bba}" => 309, "\x{6536}" => 11, "\x{738b}" => 185, "\x{754c}" => 59, "\x{88dd}" => 58, "\x{5185}" => 263, "\x{898b}" => 296, "\x{9a6c}" => 97, "\x{9060}" => 69, "\x{5979}" => 329, "\x{6218}" => 173, "\x{7af9}" => 122, "\x{9f8d}" => 307, "\x{5566}" => 288, "\x{5340}" => 279, "\x{8bc9}" => 50, "\x{8b80}" => 17, "\x{653e}" => 206, "\x{63a5}" => 226, "\x{4e07}" => 123, "\x{807d}" => 301, "\x{90fd}" => 443, "\x{5219}" => 155, "\x{4fdd}" => 132, "\x{5168}" => 325, "\x{529e}" => 140, "\x{82f1}" => 51, "\x{8cbb}" => 36, "\x{8ba9}" => 271, "\x{6a19}" => 112, "\x{89c6}" => 92, "\x{8c61}" => 74, "\x{8f6c}" => 198, "\x{6863}" => 153, "\x{961f}" => 171, "\x{96be}" => 244, "\x{8cc7}" => 489, "\x{8208}" => 147, "\x{73b0}" => 410, "\x{53c8}" => 363, "\x{80fd}" => 472, "\x{968a}" => 171, "\x{50b3}" => 137, "\x{79cd}" => 358, "\x{8bfe}" => 6, "\x{5475}" => 128, "\x{6578}" => 265, "\x{53d1}" => 421, "\x{5374}" => 169, "\x{8eab}" => 232, "\x{8d70}" => 114, "\x{662f}" => 500, "\x{65bc}" => 414, "\x{8ab0}" => 216, "\x{8c93}" => 108, "\x{60c5}" => 399, "\x{8f83}" => 266, "\x{624d}" => 331, "\x{4f5c}" => 386, "\x{7d50}" => 213, "\x{89c2}" => 91, "\x{4ea4}" => 475, "\x{56db}" => 270, "\x{91cc}" => 295, "\x{90e8}" => 287, "\x{53f7}" => 229, "\x{5904}" => 228, "\x{8c01}" => 216, "\x{519b}" => 5, "\x{5e2b}" => 222, "\x{9a8c}" => 20, "\x{4ec0}" => 380, "\x{8def}" => 345, "\x{53cd}" => 175, "\x{5c0f}" => 452, "\x{9009}" => 267, "\x{544a}" => 249, "\x{8fd9}" => 485, "\x{8996}" => 92, "\x{6b64}" => 389, "\x{6708}" => 290, "\x{5426}" => 276, "\x{984c}" => 397, "\x{624b}" => 351, "\x{5c11}" => 323, "\x{9ebc}" => 453, "\x{4e49}" => 178, "\x{5e0c}" => 190, "\x{65e5}" => 378, "\x{9519}" => 277, "\x{4ece}" => 260, "\x{5bb6}" => 436, "\x{81fa}" => 160, "\x{516d}" => 18, "\x{7b11}" => 119, "\x{96e3}" => 244, "\x{6807}" => 112, "\x{5174}" => 147, "\x{5716}" => 38, "\x{9ee8}" => 197, "\x{58eb}" => 174, "\x{5361}" => 107, "\x{56de}" => 320, "\x{7ad9}" => 435, "\x{8aaa}" => 468, "\x{5357}" => 54, "\x{8acb}" => 458, "\x{9f99}" => 307, "\x{5144}" => 105, "\x{6c92}" => 467, "\x{8bbe}" => 201, "\x{4f60}" => 483, "\x{696d}" => 166, "\x{4e70}" => 237, "\x{897f}" => 192, "\x{7ea7}" => 121, "\x{91d1}" => 158, "\x{6362}" => 73, "\x{5152}" => 86, "\x{95e8}" => 104, "\x{533a}" => 279, "\x{4e3b}" => 341, "\x{5bb9}" => 154, "\x{6743}" => 21, "\x{573a}" => 262, "\x{88e1}" => 295, "\x{5c07}" => 324, "\x{5e7e}" => 247, "\x{62a5}" => 199, "\x{4e66}" => 272, "\x{4e16}" => 181, "\x{76f4}" => 202, "\x{7559}" => 7, "\x{795e}" => 189, "\x{5f62}" => 67, "\x{9304}" => 76, "\x{8d5b}" => 35, "\x{578b}" => 32, "\x{6642}" => 470, "\x{7edf}" => 233, "\x{671f}" => 278, "\x{6570}" => 265, "\x{8fd8}" => 446, "\x{7a0b}" => 313, "\x{513f}" => 86, "\x{8a34}" => 50, "\x{94b1}" => 82, "\x{5e94}" => 360, "\x{73a9}" => 219, "\x{9020}" => 9, "\x{500b}" => 484, "\x{4ed6}" => 466, "\x{4f20}" => 137, "\x{5099}" => 65, "\x{5fc5}" => 167, "\x{957f}" => 352, "\x{9019}" => 485, "\x{5b83}" => 261, "\x{55ae}" => 182, "\x{66fe}" => 115, "\x{8207}" => 374, "\x{865f}" => 229, "\x{7834}" => 4, "\x{4ef7}" => 139, "\x{53f0}" => 428, "\x{9762}" => 365, "\x{8ba4}" => 250, "\x{61c9}" => 360, "\x{96fb}" => 445, "\x{5916}" => 337, "\x{5462}" => 336, "\x{62ff}" => 70, "\x{5199}" => 164, "\x{95ee}" => 463, "\x{6c14}" => 193, "\x{8b70}" => 141, "\x{8a66}" => 191, "\x{8ff7}" => 39, "\x{7231}" => 372, "\x{9023}" => 207, "\x{6253}" => 347, "\x{4f53}" => 304, "\x{98db}" => 15, "\x{5f0f}" => 318, "\x{7b2c}" => 317, "\x{8a9e}" => 102, "\x{8868}" => 264, "\x{6027}" => 315, "\x{9053}" => 422, "\x{4e8c}" => 369, "\x{5594}" => 113, "\x{602a}" => 16, "\x{7fa9}" => 178, "\x{904b}" => 24, "\x{6599}" => 83, "\x{5934}" => 242, "\x{5831}" => 199, "\x{6b0a}" => 21, "\x{5c08}" => 75, "\x{793e}" => 254, "\x{8b1d}" => 379, "\x{800c}" => 440, "\x{9ad8}" => 364, "\x{5167}" => 263, "\x{516b}" => 85, "\x{771f}" => 407, "\x{6703}" => 482, "\x{542c}" => 301, "\x{5148}" => 284, "\x{901a}" => 282, "\x{57fa}" => 72, "\x{5225}" => 305, "\x{601d}" => 136, "\x{4e2a}" => 484, "\x{8a0a}" => 437, "\x{52a1}" => 22, "\x{8005}" => 383, "\x{63d0}" => 461, "\x{52a0}" => 321, "\x{5e6b}" => 63, "\x{7a76}" => 129, "\x{8ab2}" => 6, "\x{5b8c}" => 227, "\x{9577}" => 352, "\x{5149}" => 239, "\x{53eb}" => 133, "\x{7531}" => 268, "\x{78ba}" => 62, "\x{4e8b}" => 396, "\x{5973}" => 359, "\x{8b58}" => 33, "\x{8d44}" => 489, "\x{5417}" => 413, "\x{534e}" => 370, "\x{88c5}" => 58, "\x{611b}" => 372, "\x{7279}" => 142, "\x{8a71}" => 375, "\x{5f37}" => 145, "\x{9a57}" => 20, "\x{5c06}" => 324, "\x{7dda}" => 98, "\x{7248}" => 243, "\x{5e74}" => 411, "\x{652f}" => 110, "\x{4e09}" => 391, "\x{53c2}" => 95, "\x{6e05}" => 392, "\x{591a}" => 454, "\x{958b}" => 376, "\x{90a3}" => 464, "\x{5e2e}" => 63, "\x{4eba}" => 493, "\x{52d9}" => 22, "\x{6211}" => 498, "\x{89ba}" => 335, "\x{8bdd}" => 375, "\x{72ec}" => 109, "\x{4e2d}" => 491, "\x{8fde}" => 207, "\x{554f}" => 463, "\x{9ede}" => 400, "\x{5e76}" => 221, "\x{66f4}" => 248, "\x{540d}" => 381, "\x{5143}" => 134, "\x{674e}" => 23, "\x{908a}" => 30, "\x{5931}" => 81, "\x{96d6}" => 26, "\x{89c1}" => 296, "\x{8bed}" => 102, "\x{79d1}" => 395, "\x{81ea}" => 441, "\x{8bb8}\\" => 240, "\x{8003}" => 246, "\x{4e00}" => 497, "\x{8111}" => 89, "\x{60a8}" => 297, "\x{89c9}" => 335, "\x{5e38}" => 298, "\x{4eec}" => 457, "\x{4e26}" => 221, "\x{4ee3}" => 230, "\x{554a}" => 269, "\x{6b21}" => 350, "\x{548c}" => 405, "\x{50f9}" => 139, "\x{8eca}" => 356, "\x{9078}" => 267, "\x{5668}" => 55, "\x{6bd4}" => 366, "\x{7b49}" => 289, "\x{6301}" => 120, "\x{4e0b}" => 460, "\x{73ed}" => 40, "\x{6c34}" => 300, "\x{5834}" => 262, "\x{8bae}" => 141, "\x{751f}" => 462, "\x{9ec3}" => 96, "\x{4e0a}" => 479, "\x{4e14}" => 212, "\x{7ed3}" => 213, "\x{7d93}" => 382, "\x{522b}" => 305, "\x{671b}" => 252, "\x{98de}" => 15, "\x{7f51}" => 280, "\x{7e3d}" => 138, "\x{53c3}" => 95, "\x{63db}" => 73, "\x{770b}" => 465, "\x{51e0}" => 247, "\x{8d77}" => 344, "\x{54c8}" => 205, "\x{6295}" => 118, "\x{8fd0}" => 24, "\x{4f55}" => 424, "\x{570b}" => 430, "\x{5408}" => 253, "\x{8a8d}" => 250, "\x{8a08}" => 225, "\x{627e}" => 273, "\x{539f}" => 286, "\x{8b1b}" => 56, "\x{516c}" => 310, "\x{537b}" => 169, "\x{559c}" => 241, "\x{7c7b}" => 57, "\x{98ce}" => 293, "\x{82e5}" => 234, "\x{76ee}" => 255, "\x{8054}" => 90, "\x{4f4d}" => 387, "\x{65e0}" => 418, "\x{540e}" => 438, "\x{91cf}" => 46, "\x{4e1c}" => 294, "\x{9673}" => 200, "\x{8ddf}" => 170, "\x{8bd5}" => 191, "\x{932f}" => 277, "\x{8be5}" => 333, "\x{59cb}" => 25, "\x{5bf9}" => 444, "\x{7a2e}" => 358, "\x{5e08}" => 222, "\x{70b9}" => 400, "\x{7b97}" => 236, "\x{54c1}" => 28, "\x{982d}" => 242, "\x{53d6}" => 188, "\x{9ec4}" => 96, "\x{547d}" => 93, "\x{6a23}" => 390, "\x{6b7b}" => 177, "\x{5f53}" => 415, "\x{77e5}" => 431, "\x{8bf4}" => 468, "\x{5922}" => 12, "\x{8f66}" => 356, "\x{8ecd}" => 5, "\x{7ed9}" => 302, "\x{58f0}" => 162, "\x{661f}" => 211, "\x{6d77}" => 101, "\x{7136}" => 417, "\x{4ee5}" => 487, "\x{822c}" => 94, "\x{4e4b}" => 451, "\x{7576}" => 415, "\x{88ab}" => 311, "\x{9593}" => 338, "\x{8cfd}" => 35, "\x{8d39}" => 36, "\x{5b66}" => 477, "\x{6210}" => 427, "\x{95dc}" => 340, "\x{670b}" => 88, "\x{6587}" => 469, "\x{753b}" => 52, "\x{8bfb}" => 17, "\x{6848}" => 53, "\x{5f9e}" => 260, "\x{6c11}" => 328, "\x{99ac}" => 97, "\x{5f20}" => 218, "\x{8a00}" => 224, "\x{8b93}" => 271, "\x{5f3a}" => 145, "\x{83ef}" => 370, "\x{6307}" => 196, "\x{5beb}" => 164, "\x{5355}" => 182, "\x{8166}" => 89, "\x{6c42}" => 130, "\x{50cf}" => 354, "\x{8cb7}" => 237, "\x{4ef6}" => 127, "\x{5316}" => 187, "\x{4e13}" => 75, "\x{5982}" => 471, "\x{5ff5}" => 8, "\x{9664}" => 60, "\x{610f}" => 402, "\x{73fe}" => 410, "\x{672a}" => 126, "\x{7684}" => 501, "\x{6c7a}" => 125, "\x{8fdb}" => 330, "\x{963f}" => 99, "\x{5c31}" => 476, "\x{4e86}" => 492, "\x{9898}" => 397, "\x{6821}" => 306, "\x{8bb0}" => 231, "\x{9648}" => 200, "\x{5171}" => 103, "\x{5f8c}" => 438, "\x{4f86}" => 478, "\x{7acb}" => 256, "\x{8a31}\\" => 240, "\x{5ea6}" => 245, "\x{670d}" => 13, "\x{8f03}" => 266, "\x{6574}" => 42, "\x{6b63}" => 377, "\x{65b0}" => 406, "\x{540c}" => 425, "\x{5c71}" => 215, "\x{4e24}" => 322, "\x{7d1a}" => 121, "\x{5b50}" => 439, "\x{81f3}" => 257, "\x{6bcf}" => 214, "\x{529b}" => 361, "\x{53e3}" => 100, "\x{4e45}" => 45, "\x{5e73}" => 161, "\x{806f}" => 90, "\x{5df1}" => 343, "\x{7814}" => 203, "\x{9032}" => 330, "\x{8ad6}" => 309, "\x{6a94}" => 153, "\x{4f1a}" => 482, "\x{7ebf}" => 98, "\x{5929}" => 456, "\x{4e50}" => 275, "\x{56fe}" => 38, "\x{53ea}" => 433, "\x{5b69}" => 66, "\x{5165}" => 274, "\x{53e6}" => 77, "\x{8a0e}" => 157, "\x{8fdc}" => 69, "\x{5247}" => 155, "\x{5236}" => 37, "\x{7535}" => 445, "\x{4efb}" => 184, "\x{7cbe}" => 3, "\x{660e}" => 348, "\x{4e94}" => 195, "\x{53d7}" => 180, "\x{8bf7}" => 458, "\x{5169}" => 322, "\x{53cb}" => 332, "\x{4e5f}" => 474, "\x{8001}" => 314, "\x{65b9}" => 394, "\x{8a2d}" => 201, "\x{6559}" => 357, "\x{524d}" => 409, "\x{5e02}" => 149, "\x{7ae0}" => 423, "\x{76f8}" => 342, "\x{756b}" => 52, "\x{5317}" => 168, "\x{5e36}" => 49, "\x{6771}" => 294, "\x{5dee}" => 48, "\x{5427}" => 388, "\x{5011}" => 457, "\x{884c}" => 384, "\x{53d8}" => 194, "\x{8a72}" => 333, "\x{7403}" => 316, "\x{8457}" => 327, "\x{7db2}" => 280, "\x{5907}" => 65, "\x{8655}" => 228, "\x{60f3}" => 450, "\x{5f88}" => 429, "\x{8272}" => 156, "\x{820d}" => 27, "\x{611f}" => 319, "\x{8bc6}" => 33, "\x{8fa6}" => 140, "\x{6b61}" => 258, "\x{4e3a}" => 480, "\x{9084}" => 446, "\x{7d44}" => 124, "\x{4e0d}" => 499, "\x{4eca}" => 238, "\x{4f4f}" => 79, "\x{52d5}" => 367, "\x{7537}" => 217, "\x{5341}" => 339, "\x{672c}" => 412, "\x{515a}" => 197, "\x{5f55}" => 76, "\x{7368}" => 109, "\x{8ba1}" => 225, "\x{7269}" => 186, "\x{773c}" => 10, "\x{6545}" => 19, "\x{6b4c}" => 64, "\x{95f4}" => 338, "\x{592a}" => 346, "\x{66f8}" => 272, "\x{89c0}" => 91, "\x{54e1}" => 159, "\x{6709}" => 496, "\x{683c}" => 87, "\x{603b}" => 138, "\x{6eff}" => 14, "\x{8a18}" => 231, "\x{5c0d}" => 444, "\x{6216}" => 362, "\x{8036}" => 29, "\x{5373}" => 78, "\x{4f7f}" => 334, "\x{505a}" => 299, "\x{7528}" => 473, "\x{5de5}" => 448, "\x{56fd}" => 430, "\x{9580}" => 104, "\x{5019}" => 61, "\x{54ea}" => 117, "\x{653f}" => 220, "\x{786e}" => 62, "\x{5927}" => 495, "\x{6a5f}" => 442, "\x{9ad4}" => 304, "\x{7063}" => 291, "\x{4efd}" => 131, "\x{732b}" => 108, "\x{4f46}" => 416, "\x{8d85}" => 31, "\x{5be6}" => 373, "\x{8fd1}" => 179, "\x{55ce}" => 413, "\x{4fe1}" => 426, "\x{6b22}" => 258, "\x{5efa}" => 209, "\x{8981}" => 488, "\x{985e}" => 57, "\x{6389}" => 44, "\x{534a}" => 2, "\x{70ba}" => 480, "\x{57ce}" => 368, "\x{7a7a}" => 172, "\x{5176}" => 398, "\x{6700}" => 408, "\x{59b3}" => 150, "\x{4f3c}" => 43, "\x{9700}" => 106, "\x{673a}" => 442, "\x{5411}" => 151, "\x{6ee1}" => 14, "\x{5b57}" => 223, "\x{4e1a}" => 166, "\x{679c}" => 403, "\x{5f97}" => 449, "\x{53ca}" => 308, "\x{5f1f}" => 235, "\x{8f49}" => 198, "\x{975e}" => 210, "\x{5403}" => 80, "\x{7406}" => 385, "\x{5b9e}" => 373, "\x{8baf}" => 437, "\x{65f6}" => 470;
}

